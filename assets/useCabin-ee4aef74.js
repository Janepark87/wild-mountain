import{A as c,E as f,G as g,u as C,b as E,J as w,_ as l}from"./index-7869a08a.js";async function h({page:e}){let r=c.from("cabins").select("*",{count:"exact"});if(e){const o=(e-1)*f,s=o+f-1;r=r.range(o,s)}const{data:a,error:t,count:n}=await r;if(t)throw console.error(t),new Error("Cabins could not be loaded.");return{data:a,count:n}}async function M(e){if(!e)return null;const a=await(await fetch(e)).blob(),t=new File([a],e.split("/").pop(),{type:a.type});return y(t)}async function m(e){const r=e.split("/").pop(),{error:a}=await c.storage.from("cabin-images").remove([r]);if(a)throw console.error(a),new Error("Cabin image could not be deleted.")}async function y(e){const r=`${Math.floor(Date.now()+1)}-${((e==null?void 0:e.name)||"").replaceAll("/","")}`,a=`https://jyuqcrdtcjnfgjtsyfhb.supabase.co/storage/v1/object/public/cabin-images/${r}`,{error:t}=await c.storage.from("cabin-images").upload(r,e);if(t)throw console.error(t),new Error("Cabin image could not be uploaded.");return a}async function q(e,r=null){var t;if(!!!e)return r;try{return r&&r!==e&&await m(r),((t=e.startsWith)==null?void 0:t.call(e,"https://jyuqcrdtcjnfgjtsyfhb.supabase.co"))?e:await y(e)}catch(n){throw console.error(n),new Error("Failed to process cabin image.")}}async function P(e,r){let a=c.from("cabins"),t;try{if(!r){const{data:d,error:i}=await a.insert([{...e,image:null}]).select().single();if(i)throw new Error("Cabin could not be created.");t=d.id,r=t}const{data:n,error:o}=await a.select("image").eq("id",r).single();if(o)throw new Error("Failed to fetch existing cabin.");const s=n==null?void 0:n.image,b=await q(e.image,s),{data:u}=await a.update({...e,image:b}).eq("id",r).single();return u}catch(n){throw console.error(n),t&&await c.from("cabins").delete().eq("id",t),new Error(`Cabins could not be ${r?"updated":"created"}.`)}}async function F(e){try{const{data:r,error:a}=await c.from("cabins").select("image").eq("id",e).single();if(a)throw console.error(a),new Error("Could not fetch cabin data.");r!=null&&r.image&&await m(r.image);const{data:t,error:n}=await c.from("cabins").delete().eq("id",e);if(n)throw console.error(n),new Error("Cabin could not be deleted.");return t}catch(r){throw console.error(r),new Error("An error occurred while deleting the cabin.")}}function S(){const e=g(),[r]=C(),a=r.get("page"),t=a?Number(a):1,{data:{data:n,count:o}={},isPending:s,isError:b}=E({queryKey:["cabins",t],queryFn:()=>h({page:t})}),u=d=>{const i=t+d,p=Math.ceil(o/f);i>=1&&i<=p&&e.prefetchQuery({queryKey:["cabins",i],queryFn:()=>h({page:i})})};return u(1),u(-1),{cabins:n,isCabinsLoading:s,isCabinsError:b,count:o}}function $(e){const r=g(),a={mutationFn:({cabinData:o,updateId:s=null})=>P(o,s),onSuccess:()=>{const o=e?"updated":"created";l.success(`Cabin successfully ${o}`),r.invalidateQueries({queryKey:["cabins"]})},onError:o=>l.error(o.message)},{mutate:t,isPending:n}=w(a);return{careateUpdateCabinMutate:t,isCabinCreatingUpdating:n}}function Q(){const e=g(),{mutate:r,isPending:a}=w({mutationFn:F,onSuccess:()=>{l.success("Cabin succesfully deleted"),e.invalidateQueries({queryKey:["cabins"]})},onError:t=>l.error(t.message)});return{deleteCabinMutate:r,isCabinDeleting:a}}export{$ as a,Q as b,M as d,S as u};
