import{j as e,M as x,c as I,s as P,T as w,u as W,S as k,D as f,P as M,o as $,e as G,r as A,$ as J,a0 as h,a1 as D,a2 as K,a3 as Q,a4 as X,a5 as Y,x as Z,y as ee,C as ae,R as ie,H as ne}from"./index-7869a08a.js";import{u as te}from"./index.esm-84e5aa2a.js";import{u as se,a as H,b as re,d as ce}from"./useCabin-ee4aef74.js";import{f as U}from"./helpers-f733994b.js";import{S as le}from"./SortBy-212218d4.js";function oe(){return e.jsxs(x,{children:[e.jsx(x.Trigger,{name:"cabin-form",children:e.jsx(I,{style:{alignSelf:"flex-end"},children:"Add new cabin"})}),e.jsx(x.Window,{name:"cabin-form",children:e.jsx(_,{})})]})}const de=P.img`
	width: 100%;
	max-width: 7rem;
	aspect-ratio: 1;
	object-fit: cover;
	border-radius: var(--border-radius-sm);
`,ue=P.div`
	font-size: 1.6rem;
	font-weight: 600;
	color: var(--color-grey-600);
	font-family: 'Sono';
`,me=P.div`
	font-family: 'Sono';
	font-weight: 600;
`,be=P.div`
	font-family: 'Sono';
	font-weight: 500;
	color: var(--color-green-700);
`;function xe({cabin:n}){const{name:t,maxCapacity:o,regularPrice:c,discount:a,image:u}=n;return e.jsxs(w.Row,{children:[e.jsx(de,{src:u,alt:t}),e.jsx(ue,{children:t}),e.jsxs("div",{children:["Fits up to ",o," guests"]}),e.jsx(me,{children:U(c)}),a?e.jsx(be,{children:U(a)}):e.jsx("span",{children:"â€”"}),e.jsx(fe,{cabin:n})]})}function ge(){const{cabins:n,isCabinsLoading:t,count:o}=se(),[c]=W();if(t)return e.jsx(k,{});const a=c.get("discount")||"all",u=a==="all"?n:a==="no-discount"?n.filter(s=>s.discount===0):n.filter(s=>s.discount>0),r=c.get("sortBy")||"created_at-desc",[d,b]=r.split("-"),g=b==="asc"?1:-1,j=u.sort((s,l)=>{if(d==="name")return s.name.localeCompare(l.name)*g;if(d==="created_at"){const y=new Date(s.created_at),p=new Date(l.created_at);return(y-p)*g}else return(s[d]-l[d])*g});return e.jsx(f,{children:e.jsxs(w,{columns:".8fr 1.8fr 1.5fr 1.5fr 1.5fr 1fr",children:[e.jsxs(w.Header,{children:[e.jsx("span",{children:"Image"}),e.jsx("span",{children:"Cabin"}),e.jsx("span",{children:"Capacity"}),e.jsx("span",{children:"Price"}),e.jsx("span",{children:"Discount"}),e.jsx("span",{})]}),e.jsx(w.Body,{data:j,dataName:"cabins",render:s=>e.jsx(xe,{cabin:s},s.id)}),e.jsx(w.Footer,{children:e.jsx(M,{count:o})})]})})}function pe(){return e.jsxs($,{children:[e.jsx(G,{filterField:"discount",options:[{value:"all",label:"All"},{value:"no-discount",label:"No discount"},{value:"with-discount",label:"With discount"}]}),e.jsx(le,{options:[{value:"name-asc",label:"Name (a-z)"},{value:"name-desc",label:"Name (z-a)"},{value:"regularPrice-asc",label:"Price (low first)"},{value:"regularPrice-desc",label:"Price (high first)"},{value:"maxCapacity-asc",label:"Capacity (low first)"},{value:"maxCapacity-desc",label:"Capacity (high first)"},{value:"created_at-asc",label:"Create date (oldest)"},{value:"created_at-desc",label:"Create date (newest)"}]})]})}function he(n){const[t,o]=A.useState(!0);return{disabled:t,setDisabled:o,handleInputValidation:a=>{const u=Object.entries(a).some(([r,d])=>{const b=n[r];return b!==Number(d)&&b!==d});o(!u)}}}function _({updateCabin:n={},onCloseModal:t}){var S,V,T,F,R,B;const{id:o,...c}=n,a=!!o,{careateUpdateCabinMutate:u,isCabinCreatingUpdating:r}=H(a),{disabled:d,setDisabled:b,handleInputValidation:g}=he(n),[j,s]=A.useState(c.image),{register:l,handleSubmit:y,reset:p,getValues:v,formState:{errors:i}}=te({defaultValues:a?n:{}}),C=()=>g(v()),z=!a||c.image!==v().image?j instanceof Blob?URL.createObjectURL(j):null:c.image,L=m=>{var N;let O=typeof m.image=="object"&&((N=m.image)==null?void 0:N.length)>0?m.image[0]:n.image;const q={...m,image:O},E={onSuccess:()=>{b(!0),a?p(v()):p(),t==null||t()}};u(a?{cabinData:q,updateId:o}:{cabinData:q},E)};return e.jsxs(J,{onSubmit:y(L),type:t?"modal":"regular",children:[e.jsx(h,{label:"Cabin name",error:(S=i==null?void 0:i.name)==null?void 0:S.message,children:e.jsx(D,{type:"text",id:"name",...l("name",{onChange:C,required:"Enter a name for your cabin."}),disabled:r})}),e.jsx(h,{label:"Maximum capacity",error:(V=i==null?void 0:i.maxCapacity)==null?void 0:V.message,children:e.jsx(D,{type:"number",id:"maxCapacity",defaultValue:1,disabled:r,...l("maxCapacity",{onChange:C,required:"Specify the maximum capacity.",min:{value:1,message:"Capaciy should be at least 1"}})})}),e.jsx(h,{label:"Regular Price",error:(T=i==null?void 0:i.regularPrice)==null?void 0:T.message,children:e.jsx(D,{type:"number",id:"regularPrice",disabled:r,...l("regularPrice",{onChange:C,required:"Enter the price for your cabin.",min:{value:1,message:"Price should be at least 1."}})})}),e.jsx(h,{label:"Discount",error:(F=i==null?void 0:i.discount)==null?void 0:F.message,children:e.jsx(D,{type:"number",id:"discount",defaultValue:0,disabled:r,...l("discount",{onChange:C,required:"Enter the cabin discount, or set it to 0 for no discount.",validate:m=>Number(m)<0?"Discount cannot be less than 0.":Number(m)<=Number(v().regularPrice)||"Discount should be less then regular price."})})}),e.jsx(h,{label:"Description for website",error:(R=i==null?void 0:i.description)==null?void 0:R.message,children:e.jsx(K,{type:"text",id:"description",disabled:r,...l("description",{onChange:C,required:"A brief description is required."})})}),e.jsx(h,{label:"Cabin photo",defaultValue:a&&c.image,updateValues:{image:z,name:c.name},error:(B=i==null?void 0:i.image)==null?void 0:B.message,children:e.jsx(Q,{id:"image",accept:"image/*",...l("image",{onChange:m=>{s(m.target.files[0]),C()},required:a?!1:"Upload an image for your cabin."}),disabled:r})}),e.jsxs(h,{children:[e.jsx(I,{type:"reset",variation:"secondary",disabled:r,onClick:()=>{p(),!a&&s(null)},children:"Clear"}),e.jsx(I,{disabled:d||r,children:a?"Edit cabin":"Create a new cabin"})]})]})}function fe({cabin:n}){const{id:t,name:o,maxCapacity:c,regularPrice:a,discount:u,description:r,image:d}=n,{deleteCabinMutate:b,isCabinDeleting:g}=re(),{careateUpdateCabinMutate:j,isCabinCreatingUpdating:s}=H(),l=async()=>{const y=await ce(d),p={name:`Copy of ${o}`,maxCapacity:c,regularPrice:a,discount:u,description:r,image:y};j({cabinData:p})};return e.jsx(f.Inner,{children:e.jsxs(x,{children:[e.jsx(f.Trigger,{id:t}),e.jsxs(f.List,{id:t,children:[e.jsx(f.Item,{icon:e.jsx(X,{}),onClick:l,disabled:s,children:"Duplicate"}),e.jsx(x.Trigger,{name:"cabin-form-edit",children:e.jsx(f.Item,{icon:e.jsx(Y,{}),children:"Edit"})}),e.jsx(x.Trigger,{name:"cabin-delete-confirmation",children:e.jsx(f.Item,{icon:e.jsx(Z,{}),children:"Delete"})})]}),e.jsx(x.Window,{name:"cabin-form-edit",children:e.jsx(_,{updateCabin:n})}),e.jsx(x.Window,{name:"cabin-delete-confirmation",children:e.jsx(ee,{resource:"Cabin",disabled:g,onConfirm:()=>b(t)})})]})})}function De(){return e.jsxs(ae,{type:"table-container",size:"lg",children:[e.jsxs(ie,{type:"horizontal",children:[e.jsx(ne,{as:"h1",children:"Cabins"}),e.jsx(pe,{})]}),e.jsx(oe,{}),e.jsx(ge,{})]})}export{De as default};
